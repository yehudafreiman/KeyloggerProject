
תיאור כללי

***יש להריץ את KeyLoggerAgent.py
ניתן להריץ גם את ExampleServer לטובת בדיקה***

הקוד מפעיל האזנה למקלדת, מרכז את האירועים ל”בלוקים” לפי דקה, ושומר אותם למבנה נתונים פנימי. כתיבה לקובץ keyfile.json מתבצעת באופן מרוכז לפי שעה (flush שעתי). לפני תחילת ההאזנה, התוכנית:
	1.	טוענת/יוצרת מפתח הצפנה (key.key),
	2.	מצפינה קובץ קיים (keyfile.json כברירת מחדל) לזיכרון,
	3.	שומרת עותק מוצפן ל־keyfile.encrypted,
	4.	ושולחת את הקובץ המוצפן לשרת ב־HTTP (כולל המפתח, לפי דרישת השרת שלך).

הערה: שליחת המפתח יחד עם ה־ciphertext אינה מומלצת אבטחתי; כאן זה נעשה כי השרת “צריך מפתח”.

איך זה עובד
	•	מופעל מאזין מקלדת (pynput).
	•	כל לחיצה נרשמת לבלוק של הדקה הנוכחית.
	•	לחיצה על SPACE: סוגרת את הבלוק הנוכחי ומעבירה אותו ל־history בזיכרון (לא כותבת לקובץ).
	•	Flush שעתי: כשמתחלפת שעה (לפי YYYY-MM-DD HH) — כל הבלוקים שנצברו נכתבים לקובץ keyfile.json כמערך JSON יחיד.
	•	לחיצה על ESC: סוגרת את הבלוק הנוכחי, מדפיסה למסוף את כל ההיסטוריה שבזיכרון, אך לא עוצרת את ההאזנה ולא כותבת לקובץ (הכתיבה נשארת לפי מנגנון השעה).
	•	בלוק ה־main מריץ קודם הצפנה ושליחה לשרת, ורק אחר כך מפעיל את ההאזנה (שחוסמת; קוד שאחריה לא ירוץ).

אין פעולה של “פענוח חזרה לקובץ” בקוד הנוכחי, ולכן לא נוצר keyfile_decrypted.json.

קבצים שנוצרים
	•	key.key – מפתח Fernet (נוצר/נטען בתחילת הריצה).
	•	keyfile.encrypted – עותק מוצפן של הקובץ שנבחר להצפנה (ברירת מחדל: keyfile.json).
	•	keyfile.json – קובץ הלוג בפורמט JSON (נכתב/מתעדכן רק בעת מעבר שעה).
	•	שים לב: אם לא חלפה שעה מאז ההרצה, ייתכן שהשינויים עדיין בזיכרון ולא בדיסק.

מחלקות עיקריות
	•	KeyLoggerService – מנהל מצב פנימי של היסטוריית האירועים לפי דקות ומחרוזת tail.
	•	KeyLoggerManager – אחראי על קליטת אירועים, סגירת בלוקים, flush שעתי, הדפסה במסוף בעת ESC, והפעלה חוסמת של המאזין.
	•	FileWriter – טוען/כותב את מערך הרשומות ל־keyfile.json כמערך JSON יחיד (לא JSON Lines).
	•	Encryptor – יוצר/טוען מפתח (key.key) ומצפין קובץ לבייטים בזיכרון (Fernet).
	•	NetworkWriter – שולח לשרת בקשת multipart/form-data עם השדות:
	•	file: התוכן המוצפן (bytes),
	•	key: המפתח (bytes) — כלול כי השרת שלך דורש זאת.

דרישות

התקנות:

pip install pynput cryptography requests

הפעלה

python main.py

כדי שהשליחה לשרת תצליח, ודא ש־HTTP Endpoint מאזין ב־http://127.0.0.1:5000/upload ומצפה לשדות file ו־key בבקשת multipart/form-data.

.

